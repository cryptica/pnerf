#!/bin/bash

# **********************************************************************
# Preamble

function absolute_path {
    (cd "$(dirname "$1")" && pwd)
}

function print_title {
    cat <<EOF
PETRINIZER: The checker for Petri Nets
[$1]
EOF
}

function print_usage {
    cat <<EOF

Usage: $0 [options] input_file
Option list:
 -h | --h | -help | --help    : Prints this help

EOF
}


# **********************************************************************
# Entry point

print_title "$*"

# parse parameters
for a in $@; do
    case $a in
        -h | --h | -help | --help)
            print_usage
            exit 0
            ;;
        -*)
            echo 'ERROR: Unknown option '$a
            exit 2
            ;;
        *) input=$a ;;
    esac
done

if [ -z "$input" ]; then
    echo 'ERROR: No input file was given'
    exit 1
fi

system_dir=$(absolute_path $0)

# Petri Net to network constraints C0
echo
echo '- Constructing C0'
echo
sicstus -l $system_dir/petri-net-to-constraints.pl -- `pwd`/$input 2>/dev/null | tee /tmp/constraints-c0.smt2

# C0 is sat?
echo
echo '- Checking SAT(C0)'
echo
z3 -smt2 /tmp/constraints-c0.smt2 | tee /tmp/assignment-a1.smt2

# Model A to trap conditions C_theta

# C_theta is sat?

# Model A_theta to refined constraints Cn+1